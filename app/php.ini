; ===== Nextcloud-optimized php.ini (FPM) =====
; Runs in: nextcloud:stable-fpm-alpine
; Location in container: /usr/local/etc/php/php.ini

; --- General hardening & consistency ---
expose_php = Off
short_open_tag = Off
default_charset = "UTF-8"
; Set your preferred zone if not UTC
date.timezone = "UTC"

; --- Resource limits (uploads & long requests) ---
; Align with nginx fastcgi_read_timeout (600s)
max_execution_time = 600
max_input_time     = 600

; Nextcloud web uploads / chunking (match/undercut nginx client_max_body_size)
post_max_size       = 512M
upload_max_filesize = 512M
max_file_uploads    = 200
memory_limit        = 512M     ; raise to 1024M on large installs

; Nextcloud recommends disabling output buffering
; (prevents issues with streaming/chunked responses)
output_buffering = 0

; --- Realpath cache (speeds up file lookups in large codebases) ---
realpath_cache_size = 4096k
realpath_cache_ttl  = 600

; --- Opcache (critical for performance) ---
zend_extension=opcache
opcache.enable=1
opcache.enable_cli=0
opcache.memory_consumption=256
opcache.interned_strings_buffer=16
opcache.max_accelerated_files=100000
opcache.save_comments=1
opcache.revalidate_freq=60          ; check file changes at most once per minute
opcache.fast_shutdown=1
; JIT offers no benefit to Nextcloud and can cause instability on Alpine/musl
opcache.jit=0
opcache.jit_buffer_size=0

; --- APCu (local cache; Nextcloud uses it) ---
; The Nextcloud FPM image includes APCu. Keep a sensible shared memory size.
apc.enable_cli=1
apc.shm_size=128M

; --- Sessions ---
; Keep default "files" unless you deliberately move PHP sessions to Redis.
; (Nextcloud itself uses Redis for locking via config.php, independent of PHP sessions)

; --- Error visibility/logging ---
display_errors = Off
display_startup_errors = Off
log_errors = On
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; --- FPM/CGI tweaks (safe defaults) ---
;fastcgi.logging = 0

; --- Mail defaults (unused in FPM containers, harmless) ---
SMTP = localhost
smtp_port = 25
